version: '3.7'
services:
  redis:
    image: redis
    networks:
      default:
        ipv4_address: 192.168.69.4
  nginx:
    build:
      context: ./docker/dev
      dockerfile: nginx/Dockerfile
    environment:
      TZ: "Europe/Moscow"
    volumes:
      - ./app:/app
    depends_on:
      - php-fpm
    networks:
      default:
        ipv4_address: 192.168.69.3
  php-fpm:
    build:
      context: ./docker/dev
      dockerfile: php-fpm/Dockerfile
    volumes:
      - ./app:/app
    depends_on:
      - redis
      - db
    extra_hosts:
      - host.docker.internal:host-gateway
    environment:
      TZ: "Europe/Moscow"
      PHP_IDE_CONFIG: serverName=gid
      REDIS_PORT: 6379
      REDIS_HOST: redis
    networks:
      default:
        ipv4_address: 192.168.69.3
        aliases:
          - gid
    links:
      - "db:app"
  php-cli:
    build:
      context: ./docker/dev
      dockerfile: php-cli/Dockerfile
    volumes:
      - ./app:/app
    depends_on:
      - redis
      - db
    extra_hosts:
      - host.docker.internal:host-gateway
    environment:
      TZ: "Europe/Moscow"
      REDIS_PORT: 6379
      REDIS_HOST: redis
      PHP_IDE_CONFIG: serverName=gid
    networks:
      default:
        ipv4_address: 192.168.69.3
    tty: true
  db:
    image: postgres:13
    volumes:
      - ./storage/docker/postgres:/var/lib/postgresql/data
    environment:
      TZ: 'Europe/Moscow'
      POSTGRES_USER: gid
      POSTGRES_PASSWORD: gid
      POSTGRES_DB: gid
    networks:
      default:
        ipv4_address: 192.168.69.4
networks:
  default:
    external:
      name: gid
